{% extends 'base.html' %}
{% load static %}
{% block page_title %} {{ page_title }} {% endblock %}
{% block main %}
<!-- App body starts -->
<div class="row gx-4">
  <div class="col-sm-12">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Filtres</h5>
      </div>
      <div class="card-body">
        <!-- Row starts -->
          {% csrf_token %}
        <div class="row gx-4 align-items-center">
          <div class="col-lg-3 col-sm-4 col-12">
               <div class="mb-3">
                    <label class="form-label" for="date_debut">Du</label>
                    <div class="input-group">
                        <span class="input-group-text">
                          <i class="bi bi-calendar4"></i>
                        </span>
                        <input type="text" id="date_debut" class="form-control datepicker"/>
                    </div>
               </div>
          </div>
          <div class="col-lg-3 col-sm-4 col-12">
            <div class="mb-3">
                <label class="form-label" for="date_fin">Au</label>
                <div class="input-group">
                    <span class="input-group-text">
                      <i class="bi bi-calendar4"></i>
                    </span>
                    <input type="text" id="date_fin" class="form-control datepicker"/>
                </div>
            </div>
          </div>
          <div class="col-lg-3 col-sm-4 col-12">
            <div class="d-flex gap-2">
              <button type="button" id="submitFiltre" class="btn btn-outline-primary">
                Filtrer
              </button>
            </div>
          </div>
        </div>
        <!-- Row ends -->
      </div>
    </div>
  </div>
</div>

<div class="row gx-4">
    <!-- Row starts -->
    <div class="col-lg-4 col-sm-6 col-12">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Prestations effectuées</h5>
      </div>
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h2 id="nbPrestations">0</h2>
            <h5 class="mb-2 fw-light" id="totalNetPrestations">0</h5>
          </div>
        </div>
      </div>
    </div>
    </div>

    <div class="col-lg-4 col-sm-6 col-12">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Piscine</h5>
      </div>
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h2 id="montantPiscine">0</h2>
    <!--            <h5 class="mb-2 fw-light" id="totalNetPrestations">0</h5>-->
          </div>
        </div>
      </div>
    </div>
    </div>
</div>

<!-- Row starts -->
<div class="row gx-4">
  <div class="col-12">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Ventes des Produits du Salon</h5>
      </div>
      <div class="card-body d-flex justify-content-between flex-wrap">
        <div class="col-xl-4 col-sm-6 col-12">
          <div class="card mb-4">
            <div class="card-body">
              <div class="m-0 p-2 border border-secondary rounded-2">
                <div class="fw-semibold mb-3">Nombre de Ventes</div>
                <div class="position-relative">
                  <h2 id="nombreVentes">0</h2>
                  <div class="mb-3"><span class="fs-5 badge bg-danger text-white me-1" id="totalVentes">0</span></div>
                  <i
                    class="bi bi-box-seam display-3 text-light position-absolute end-0 top-0 opacity-50 mt-n4"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-4 col-sm-6 col-12">
          <div class="card mb-4">
            <div class="card-body">
              <div class="m-0 p-2 border border-secondary rounded-2">
                <div class="fw-semibold mb-3">Ventes Cash</div>
                <div class="position-relative">
                  <h2 id="nombreVentesCash">0</h2>
                  <div class="mb-3"><span class="fs-5 badge bg-danger text-white me-1" id="totalVentesCash">0</span></div>
                  <i
                    class="bi bi-bar-chart display-3 text-light position-absolute end-0 top-0 opacity-50 mt-n4"></i>
                </div>
              </div>

            </div>
          </div>
        </div>
        <div class="col-xl-4 col-sm-6 col-12">
          <div class="card mb-4">
            <div class="card-body">
              <div class="m-0 p-2 border border-secondary rounded-2">
                <div class="fw-semibold mb-3">Ventes à Crédit</div>
                <div class="position-relative">
                  <h2 id="nombreVentesCredit">0</h2>
                  <div class="mb-3"><span class="fs-5 badge bg-danger text-white me-1" id="totalVentesCredit">0</span></div>
                  <i class="bi bi-sticky display-3 text-light position-absolute end-0 top-0 opacity-50 mt-n4"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
<!--
        <div class="col-xl-3 col-sm-6 col-12">
          <div class="card mb-4 card-bg">
            <div class="card-body">
              <div class="m-0 text-white p-2 border border-secondary rounded-2">
                <div class="fw-semibold mb-3">Total Revenue</div>
                <div class="position-relative">
                  <h2>$900</h2>
                  <span class="badge bg-white text-danger small mb-3">
                    <i class="bi bi-exclamation-circle-fill me-1 text-danger"></i>7 new outlets
                  </span>
                  <div class=""><span class="badge bg-dark me-1">+36%</span>Compared to last week</div>
                  <i
                    class="bi bi-wallet2 display-3 text-white position-absolute end-0 top-0 opacity-25 mt-n4"></i>
                </div>
                <div class="mt-3">
                  <div class="small">Last updated on <span class="opacity-50">Today, 9:29:59 AM</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        -->
      </div>
    </div>
  </div>
</div>
<!-- Row ends -->

<!-- Row Entrées / Sorties -->
<div class="row gx-4">
  <div class="col-sm-12">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Entrées / Sorties</h5>
      </div>
      <div class="card-body">
        <div class="accordion" id="accordionEnreesSorties">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingSpecialTitleOne">
              <button class="accordion-button" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapseSpecialTitleOne" aria-expanded="true"
                aria-controls="collapseSpecialTitleOne">
                <div class="d-flex flex-column">
                  <h5 class="m-0">SALON</h5>
                </div>
              </button>
            </h2>
            <div id="collapseSpecialTitleOne" class="accordion-collapse collapse show"
              aria-labelledby="headingSpecialTitleOne" data-bs-parent="#accordionEnreesSorties">
              <div class="accordion-body">
                <!-- Row starts -->
                <div class="row gx-4">
                  <div class="col-sm-4">

                    <!-- Graph starts -->
                    <div class="graph-body">
                      <div id="income"></div>
                    </div>
                    <!-- Graph ends -->

                    <!-- Stats starts -->
                    <div class="text-center mb-5">
                      <h2 id="montantEntreeSalon"></h2>
<!--                      <span class="badge bg-secondary small mb-2">-->
<!--                        <i class="bi bi-exclamation-circle-fill me-1 text-warning"></i>3 higher income-->
<!--                      </span>-->
<!--                      <div class=""><span class="badge bg-dark me-1">+26% Compared to last week</span></div>-->
                    </div>
                    <!-- Stats ends -->

                  </div>
                  <div class="col-sm-4">

                    <!-- Graph starts -->
                    <div class="graph-body">
                      <div id="expenses"></div>
                    </div>
                    <!-- Graph ends -->

                    <!-- Stats starts -->
                    <div class="text-center mb-5">
                      <h2 id="montantSortisSalon"></h2>
<!--                      <span class="badge bg-secondary small mb-2">-->
<!--                        <i class="bi bi-exclamation-circle-fill me-1 text-warning"></i>6 higher expenses-->
<!--                      </span>-->
<!--                      <div class=""><span class="badge bg-dark me-1">+33% Compared to last week</span></div>-->
                    </div>
                    <!-- Stats ends -->

                  </div>
                  <div class="col-sm-4">

                    <!-- Graph starts -->
                    <div class="graph-body">
                      <div id="revenue"></div>
                    </div>
                    <!-- Graph ends -->

                    <!-- Stats starts -->
                    <div class="text-center mb-5">
                      <h2 id="beneficeSalon"></h2>
<!--                      <span class="badge bg-secondary small mb-2">-->
<!--                        <i class="bi bi-exclamation-circle-fill me-1 text-warning"></i>9 higher revenue-->
<!--                      </span>-->
<!--                      <div class=""><span class="badge bg-danger me-1">+49% compared to last week</span></div>-->
                    </div>
                    <!-- Stats ends -->

                  </div>
                </div>
                  <!-- Row ends -->
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingSpecialTitleTwo">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapseSpecialTitleTwo" aria-expanded="false"
                aria-controls="collapseSpecialTitleTwo">
                <div class="d-flex flex-column">
                  <h5 class="m-0">RESTAURANT</h5>
                </div>
              </button>
            </h2>
            <div id="collapseSpecialTitleTwo" class="accordion-collapse collapse"
              aria-labelledby="headingSpecialTitleTwo" data-bs-parent="#accordionEnreesSorties">
              <div class="accordion-body">
                <!-- Les Graphs-->
                  <div class="row gx-4">
                      <div class="col-sm-4">

                        <!-- Graph starts -->
                        <div class="graph-body">
                          <div id="incomeResto"></div>
                        </div>
                        <!-- Graph ends -->

                        <!-- Stats starts -->
                        <div class="text-center mb-5">
                          <h2 id="montantEntreeResto"></h2>
    <!--                      <span class="badge bg-secondary small mb-2">-->
    <!--                        <i class="bi bi-exclamation-circle-fill me-1 text-warning"></i>3 higher income-->
    <!--                      </span>-->
    <!--                      <div class=""><span class="badge bg-dark me-1">+26% Compared to last week</span></div>-->
                        </div>
                        <!-- Stats ends -->

                      </div>
                      <div class="col-sm-4">

                        <!-- Graph starts -->
                        <div class="graph-body">
                          <div id="expensesResto"></div>
                        </div>
                        <!-- Graph ends -->

                        <!-- Stats starts -->
                        <div class="text-center mb-5">
                          <h2 id="montantSortisResto"></h2>
    <!--                      <span class="badge bg-secondary small mb-2">-->
    <!--                        <i class="bi bi-exclamation-circle-fill me-1 text-warning"></i>6 higher expenses-->
    <!--                      </span>-->
    <!--                      <div class=""><span class="badge bg-dark me-1">+33% Compared to last week</span></div>-->
                        </div>
                        <!-- Stats ends -->

                      </div>
                      <div class="col-sm-4">

                        <!-- Graph starts -->
                        <div class="graph-body">
                          <div id="revenueResto"></div>
                        </div>
                        <!-- Graph ends -->

                        <!-- Stats starts -->
                        <div class="text-center mb-5">
                          <h2 id="beneficeResto"></h2>
    <!--                      <span class="badge bg-secondary small mb-2">-->
    <!--                        <i class="bi bi-exclamation-circle-fill me-1 text-warning"></i>9 higher revenue-->
    <!--                      </span>-->
    <!--                      <div class=""><span class="badge bg-danger me-1">+49% compared to last week</span></div>-->
                        </div>
                        <!-- Stats ends -->
                      </div>
                  </div>
                  <!-- Tableaux des Entrees/Sorties du Restaurant Starts -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Row Entrées / Sorties ends -->

<!-- Row starts -->
<div class="row gx-4">
  <div class="col-sm-12">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Customers</h5>
      </div>
      <div class="card-body">

        <!-- Row starts -->
        <div class="row gx-4">
          <div class="col-sm-12 col-12">

            <div class="d-flex gap-3 flex-wrap">
              <div class="position-relative">
                <h2>200</h2>
                <span class="badge bg-secondary small mb-3">
                  <i class="bi bi-exclamation-circle-fill me-1 text-danger"></i>3 new customers
                </span>
                <div class=""><span class="badge bg-danger me-1">+33%</span>Compared to
                  last week</div>
              </div>
              <div class="position-relative">
                <h2>300</h2>
                <span class="badge bg-secondary small mb-3">
                  <i class="bi bi-exclamation-circle-fill me-1 text-danger"></i>6 customers online
                </span>
                <div class=""><span class="badge bg-danger me-1">+26%</span>Compared to
                  last week</div>
              </div>
              <div class="position-relative">
                <h2>600</h2>
                <span class="badge bg-secondary small mb-3">
                  <i class="bi bi-exclamation-circle-fill me-1 text-danger"></i>8 active customers
                </span>
                <div class=""><span class="badge bg-danger me-1">+22%</span>Compared to
                  last week</div>
              </div>
              <div class="position-relative">
                <h2>400</h2>
                <span class="badge bg-secondary small mb-3">
                  <i class="bi bi-exclamation-circle-fill me-1 text-danger"></i>3 inactive customers
                </span>
                <div class=""><span class="badge bg-danger me-1">+32%</span>Compared to last week</div>
              </div>
            </div>

          </div>
          <div class="col-sm-12 col-12">
            <div class="graph-body">
              <div id="invoices"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- Row ends -->
    </div>
  </div>
</div>
<!-- Row ends -->

<!-- Row starts -->
<div class="row gx-4">
  <div class="col-xl-4 col-sm-6">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Prestations par Employé</h5>
      </div>
      <div class="card-body">
        <div class="scroll350">
          <ul class="user-messages">
            {% for prest in prestations_par_reference %}
              <p>Len {{ prest.prestataire | length}}</p>
              {% for prestataire in prest.prestataire %}
            <li>
              <div class="customer bg-secondary">{{prestataire.initiales}}</div>
              <div class="delivery-details">
                <span class="badge bg-secondary">{{ prest.reference }}</span>
                <h5>{{ prestataire.nom_complet }}</h5>
                <p>{{ prestataire.email }}</p>
                <p>Nombre Services : {{ prestataire.nb_services }}</p>
                <p>Services : {{ prestataire.services }}</p>
                <p>Date : {{ prest.date }}</p>
              </div>
            </li>
              {% endfor %}
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-4 col-sm-6">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Payments</h5>
      </div>
      <div class="card-body">
        <div class="scroll350">
          <div class="my-4">
            <div class="d-flex align-items-start">
              <img src="assets/images/user3.png" class="img-4x me-3 rounded-circle"
                alt="Axis Admin Template" />
              <div class="mb-4">
                <h5 class="mb-1">Joan Paul</h5>
                <p class="mb-1">3 day ago</p>
                <p class="mb-1 small">Unpaid invoice ref. #26788</p>
                <span class="badge bg-secondary">Unpaid</span>
              </div>
            </div>
            <div class="d-flex align-items-start">
              <img src="assets/images/user4.png" class="img-4x me-3 rounded-circle"
                alt="Axis Admin Template" />
              <div class="mb-4">
                <h5 class="mb-1">Vincenzo Lyons</h5>
                <p class="mb-1">3 hours ago</p>
                <p class="mb-1 small">Paid invoice ref. #23457</p>
                <span class="badge bg-secondary">Paid</span>
              </div>
            </div>
            <div class="d-flex align-items-start">
              <img src="assets/images/user5.png" class="img-4x me-3 rounded-circle"
                alt="Axis Admin Template" />
              <div class="mb-4">
                <h5 class="mb-1">Clarence Wyatt</h5>
                <p class="mb-1">7 hours ago</p>
                <p class="mb-1 small">Paid invoice ref. #23459</p>
                <span class="badge bg-secondary">Partially Paid</span>
              </div>
            </div>
            <div class="d-flex align-items-start">
              <img src="assets/images/user1.png" class="img-4x me-3 rounded-circle"
                alt="Axis Admin Template" />
              <div class="mb-4">
                <h5 class="mb-1">Keenan Vega</h5>
                <p class="mb-1">One week ago</p>
                <p class="mb-1 small">Paid invoice ref. #34546</p>
                <span class="badge bg-secondary">Paid</span>
              </div>
            </div>
            <div class="d-flex align-items-start">
              <img src="assets/images/user2.png" class="img-4x me-3 rounded-circle"
                alt="Axis Admin Template" />
              <div class="m-0">
                <h5 class="mb-1">Noe Carey</h5>
                <p class="mb-1">1 day ago</p>
                <p class="mb-1 small">Unpaid invoice ref. #23473</p>
                <span class="badge bg-secondary">Unpaid</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-4 col-sm-12">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Project Activity</h5>
      </div>
      <div class="card-body">
        <div class="scroll350">
          <div class="activity-feed">
            <div class="feed-item">
              <span class="feed-date pb-1" data-bs-toggle="tooltip" data-bs-title="Today 05:32:35">An
                Hour Ago</span>
              <div class="mb-1">
                <a href="#">Janie Mcdonald</a> - Task marked as complete.
              </div>
              <div class="mb-1">Project Name - <a href="#" class="text-danger">Bootstrap Gallery</a></div>
              <div>Admin Dashboards <i class="bi bi-arrow-up-right"></i> </div>
            </div>
            <div class="feed-item">
              <span class="feed-date pb-1" data-bs-toggle="tooltip" data-bs-title="Today 05:32:35">An
                Hour Ago</span>
              <div class="mb-1">
                <a href="#">Janie Mcdonald</a> - Task marked as complete.
              </div>
              <div class="mb-1">Project Name - <a href="#" class="text-danger">Bootstrap Gallery</a></div>
              <div>Admin Dashboards <i class="bi bi-arrow-up-right"></i> </div>
            </div>
            <div class="feed-item">
              <span class="feed-date pb-1" data-bs-toggle="tooltip" data-bs-title="Today 05:32:35">An
                Hour Ago</span>
              <div class="mb-1">
                <a href="#">Janie Mcdonald</a> - Task marked as complete.
              </div>
              <div class="mb-1">Project Name - <a href="#" class="text-danger">Bootstrap Gallery</a></div>
              <div>Admin Dashboards <i class="bi bi-arrow-up-right"></i> </div>
            </div>
            <div class="feed-item">
              <span class="feed-date pb-1" data-bs-toggle="tooltip" data-bs-title="Today 05:32:35">An
                Hour Ago</span>
              <div class="mb-1">
                <a href="#">Janie Mcdonald</a> - Task marked as complete.
              </div>
              <div class="mb-1">Project Name - <a href="#" class="text-danger">Bootstrap Gallery</a></div>
              <div>Admin Dashboards <i class="bi bi-arrow-up-right"></i> </div>
            </div>
            <div class="feed-item">
              <span class="feed-date pb-1" data-bs-toggle="tooltip" data-bs-title="Today 05:32:35">An
                Hour Ago</span>
              <div class="mb-1">
                <a href="#">Janie Mcdonald</a> - Task marked as complete.
              </div>
              <div class="mb-1">Project Name - <a href="#" class="text-danger">Bootstrap Gallery</a></div>
              <div>Admin Dashboards <i class="bi bi-arrow-up-right"></i> </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-4 col-sm-6">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Deals</h5>
      </div>
      <div class="card-body">
        <div class="graph-body-lg">
          <div id="deals"></div>
        </div>
        <div class="my-3 text-center">
          <h1>3850</h1>
          <h5 class="mb-2">
            Monthly Deals Growth
          </h5>
          <p class="m-0">
            Measure how fast you’re growing monthly recurring deals.
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-4 col-sm-6">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Leads</h5>
      </div>
      <div class="card-body">
        <div class="graph-body-lg auto-align-graph">
          <div id="leads"></div>
        </div>
        <div class="my-3 text-center">
          <h1>2500</h1>
          <h5 class="mb-2">
            Monthly Leads Growth
          </h5>
          <p class="m-0">
            Measure how fast you’re growing monthly recurring deals.
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-4 col-sm-12">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="card-title">Tickets</h5>
      </div>
      <div class="card-body">
        <div class="graph-body-lg auto-align-graph">
          <div id="tickets"></div>
        </div>
        <div class="my-3 text-center">
          <h1>800</h1>
          <h5 class="mb-2">
            Monthly Tickets Growth
          </h5>
          <p class="m-0">
            Measure how fast you’re growing monthly recurring deals.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Row ends -->

<!-- App body ends -->
{% endblock %}

{% block custom_js %}
<script src="{% static 'assets/js/datatables.min.js' %}"></script>
<script src="{% static 'assets/js/modernizr.js' %}"></script>
<script src="{% static 'assets/vendor/daterange/daterange.js' %}"></script>
<script src="{% static 'assets/vendor/daterange/custom-daterange.js' %}"></script>
<script>
    $(document).ready(function(){

        function getCSRFToken(){
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
          return csrfToken ? csrfToken.value : "";
        }

        // Creer une Date l'initialisation du dom pour charger les Data du jour
        const myDate = new Date();
        const start = `${myDate.getFullYear()}-${myDate.getMonth() + 1}-${myDate.getDate()}`;
        const end = `${myDate.getFullYear()}-${myDate.getMonth() + 1}-${myDate.getDate()}`;

        // Soumettre la requete de filtre
        $("#submitFiltre").click(function(){
            const date_debut_str = $("#date_debut").val()
            const date_fin_str = $("#date_fin").val()
            const date_debut = `${date_debut_str.split('/')[2]}-${date_debut_str.split('/')[1]}-${date_debut_str.split('/')[0]}`;
            const date_fin = `${date_fin_str.split('/')[2]}-${date_fin_str.split('/')[1]}-${date_fin_str.split('/')[0]}`;

            get_statistiques(date_debut, date_fin)
            situationSalon(date_debut, date_fin)

        })

        function get_stats_prestations(data){
            $("#nbPrestations").text(data.nb_prestations)
            $("#totalNetPrestations").text(data.montant_net_prestations)
        }

        function get_statistiques(dateDebut, dateFin){
            const data = {
                startDate: dateDebut,
                endDate: dateFin,
            }

            $.ajax({
                url: "/employe/dashmin/filtre/",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(data),
                headers: { 'X-CSRFToken': getCSRFToken() },
                success: function(res){

                  const stats_vente_produits = res.data.stats_vente_produits;
                  const stats_prestaions = res.data['get_stats_prestaions'];
                  const stats_piscine = res.data['get_stats_piscine'];


                  // Data de la Piscine
                  $("#montantPiscine").text(stats_piscine)
                  // Statistiques sur la Prestation
                  get_stats_prestations(stats_prestaions)

                  $("#nombreVentes").text(stats_vente_produits.nb_ventes)
                  $("#nombreVentesCash").text(stats_vente_produits.nb_ventes_cash)
                  $("#nombreVentesCredit").text(stats_vente_produits.nb_ventes_credits)

                  $("#totalVentes").text(stats_vente_produits.total_net_ventes.toLocaleString() + " GNF")
                  $("#totalVentesCash").text(stats_vente_produits.total_ventes_cash.toLocaleString() + " GNF")
                  $("#totalVentesCredit").text(stats_vente_produits.total_ventes_credits.toLocaleString() + " GNF")
                },
                error: function(error){
                    console.log(error)
                },
            })

        }

        // Charger les Données du jour à l'initialisation de la page
        get_statistiques(start, end)


        function situationEntreesSorties(
            url, dateDebut, dateFin, $montantEntree,
            $montantSorti, $benefice, incomeGraph, expensesGraph, revenueGraph
        ){
          const data = {
              start_date:dateDebut,
              end_date:dateFin
          }


          $.ajax({
              url: url,
              method: "POST",
              contentType: "application/json",
              data: JSON.stringify(data),
              headers: { 'X-CSRFToken': getCSRFToken() },
              success: function(res){

                const montant_entrees = res.data.total_net_entree
                const montant_sorties = res.data.depenses
                const benefice = montant_entrees - montant_sorties

                // Calcule des Montants et Pourcentage
                $montantEntree.text(montant_entrees.toLocaleString() + " GNF")
                $montantSorti.text(montant_sorties.toLocaleString() + " GNF")
                $benefice.text(benefice.toLocaleString() + " GNF")

                const totalEntreesSorties = montant_entrees + montant_sorties
                const percent_entrees = montant_entrees ? Math.round((montant_entrees / montant_entrees) * 100) : 0
                const percent_sorties = montant_entrees ? Math.round((montant_sorties / montant_entrees) * 100) : montant_sorties ? Math.round(montant_sorties / montant_sorties) * 100 : 0
                const percent_benefice = montant_entrees ? Math.round((benefice / montant_entrees) * 100) : 0

                // Statistiques des mouvements
                graphStatistics(incomeGraph, percent_entrees, "Entrées", ["#9196a2", "#ba1654", "#EEEEEE", "#CCCCCC", "#ba1654", "#222222"])
                graphStatistics(expensesGraph, percent_sorties, "Dépenses", ["#ba1654", "#EEEEEE", "#CCCCCC", "#ba1654", "#222222"])
                graphStatistics(revenueGraph, percent_benefice, "Solde", ["#126621"])
              },
              error: function(error){
                  console.log("erreur :", error)
              },
          })
        }


        // Definition des urls pour recuperer les mouvements Entrees/Sorties du Salon et du Restaurant
        const url_salon = "/employe/dashmin/situation_salon/"
        const url_resto = "/employe/dashmin/situation_resto/"

        let montantEntree = $("#montantEntreeSalon")
        let montantSorti = $("#montantSortisSalon")
        let benefice = $("#beneficeSalon")
        let tabEntree = $("#entreesSalon")
        let tabDepenses = $("#sortiesSalon")

        let montantEntreeResto = $("#montantEntreeResto")
        let montantSortiResto = $("#montantSortisResto")
        let beneficeResto = $("#beneficeResto")
        let tabEntreeResto = $("#entreesResto")
        let tabDepensesResto = $("#sortiesResto")

        // Les Graphs du Salon
        const incomeGraphSalon = "income"
        const expensesGraphSalon = "expenses"
        const revenueGraphSalon = "revenue"

        // Les Graphs du Restaurant
        const incomeGraphResto = "incomeResto"
        const expensesGraphResto = "expensesResto"
        const revenueGraphResto = "revenueResto"

        //Recuperer les Entrees/Sorties du Salon via le filtre
        function situationSalon(dateDebut, dateFin){
          montantEntree = $("#montantEntreeSalon")
          montantSorti = $("#montantSortisSalon")
          benefice = $("#beneficeSalon")
          tabEntree = $("#entreesSalon")
          tabDepenses = $("#sortiesSalon")

          // Filtrer les Donnees Entrees/Sorties du Salon
          const url_salon = "/employe/dashmin/situation_salon/"
          situationEntreesSorties(url_salon, dateDebut, dateFin,
            montantEntree, montantSorti, benefice,
            incomeGraphSalon, expensesGraphSalon, revenueGraphSalon
          )

          // Filtrer les Donnees Entrees/Sorties du Restaurant
          montantEntreeResto = $("#montantEntreeResto")
          montantSortiResto = $("#montantSortisResto")
          beneficeResto = $("#beneficeResto")
          tabEntreeResto = $("#entreesResto")
          tabDepensesResto = $("#sortiesResto")

          situationEntreesSorties(url_resto, dateDebut, dateFin, montantEntreeResto, montantSortiResto,
            beneficeResto, incomeGraphResto, expensesGraphResto, revenueGraphResto
          )
        }

        // Recuperer les Entrees/Sorties du Salon à l'initialisation de la page
        situationEntreesSorties(url_salon, start, end, montantEntree, montantSorti, benefice, "income", "expenses", "revenue")

        // Recuperer les Entrees/Sorties du Restaurant à l'initialisation de la page
        situationEntreesSorties(url_resto, start, end, montantEntreeResto, montantSortiResto, beneficeResto,
            incomeGraphResto, expensesGraphResto, revenueGraphResto
        )

        // Graph 1
        let chart = {};
        function graphStatistics(idGraph, percent, graphLabel, tabColors){
          if(chart[idGraph]){
            chart[idGraph].updateSeries([percent]);
            chart[idGraph].updateOptions({
              labels: [graphLabel],
              colors: tabColors
            });
          }
          else{
            var options = {
              series: [percent],
              chart: {
                  height: 280,
                  type: "radialBar",
                  offsetY: -10,
              },
              plotOptions: {
                  radialBar: {
                      startAngle: -135,
                      endAngle: 135,
                      dataLabels: {
                          name: {
                              fontSize: "16px",
                              color: undefined,
                              offsetY: 0,
                          },
                          value: {
                              offsetY: 20,
                              fontSize: "22px",
                              color: undefined,
                              formatter: function (val) {
                                  return val + "%";
                              },
                          },
                      },
                  },
              },
              colors: tabColors,
              stroke: {
                  dashArray: 4,
              },
              labels: [graphLabel],
            };
            chart[idGraph] = new ApexCharts(document.querySelector("#" + idGraph), options);
            chart[idGraph].render();
          }
        }
    })
</script>
{% endblock %}
